# üß© Practical 6 ‚Äî Enable MFA (Multi-Factor Authentication)

## üéØ Objective
Enable **Multi-Factor Authentication (MFA)** for IAM users and enforce it through a **conditional IAM policy**.  
This ensures users must authenticate using both a **password** and a **temporary MFA code** before performing sensitive actions.

---

## ü™ú Step-by-Step Implementation

### **Step 1: Open IAM Dashboard**
1. Log in to the **AWS Management Console**.
2. Navigate to **IAM ‚Üí Users**.
3. Select the user (e.g., `devops-user`) who needs MFA enabled.

---

### **Step 2: Assign MFA Device**
1. Go to the **Security credentials** tab.
2. Under **Multi-factor authentication (MFA)**, click **Assign MFA device**.
3. Choose one of the options:
   - **Virtual MFA device** (recommended for testing, e.g., Google Authenticator or Authy)
   - **Hardware MFA device** (physical key)

<img width="1775" height="850" alt="image" src="https://github.com/user-attachments/assets/606b1ce8-f5f7-402f-b6eb-ac58fb5b4bf6" />

---

### **Step 3: Configure Virtual MFA**
1. Open your authenticator app on your mobile.
2. Scan the **QR code** displayed on AWS console.
3. Enter the **two consecutive MFA codes** generated by the app.
4. Click **Add MFA**.

üñºÔ∏è _Add Screenshot: MFA QR code and verification page_

---

### **Step 4: Verify MFA Activation**
Once successful:
- The MFA device will show as **Assigned**.
- You can see the **device name** and **ARN** (e.g., `arn:aws:iam::111111111111:mfa/devops-user`).

<img width="969" height="807" alt="image" src="https://github.com/user-attachments/assets/235c0b56-dab0-4f40-b36f-8b50a1d066d2" />

---

### **Step 5: Create Conditional IAM Policy to Enforce MFA**
Now, enforce MFA using a **policy condition** that allows access only when MFA is used.

1. Go to **IAM ‚Üí Policies ‚Üí Create policy**.
2. Select **JSON** tab and paste the following:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "BlockMostAccessUnlessSignedInWithMFA",
      "Effect": "Deny",
      "NotAction": [
        "iam:CreateVirtualMFADevice",
        "iam:EnableMFADevice",
        "iam:GetUser",
        "iam:ListMFADevices",
        "iam:ListVirtualMFADevices",
        "iam:ResyncMFADevice"
      ],
      "Resource": "*",
      "Condition": {
        "BoolIfExists": {
          "aws:MultiFactorAuthPresent": "false"
        }
      }
    }
  ]
}

```
3. Click Next, name the policy ‚Üí EnforceMFAAccessPolicy, and Create policy.

---

## üß© Step 6: Attach Policy to IAM User or Group

1. Go to **IAM ‚Üí Users** or **Groups**.  
2. Select the entity (for example, `devops-user`).  
3. Under the **Permissions** tab, click **Add permissions ‚Üí Attach existing policies directly**.  
4. Search for and select **EnforceMFAAccessPolicy**.  
5. Click **Add permissions** to attach the policy.
<img width="1674" height="424" alt="image" src="https://github.com/user-attachments/assets/1ce187b2-17dc-4ba4-ae67-7cc2ceec940c" />

---
## üß© Step 7: Test MFA Enforcement

1. **Log in as the IAM user without MFA** ‚Äî you should see **AccessDenied** for most operations.  
2. **Log in with MFA enabled** and re-try the same actions ‚Äî operations should now succeed.  

---

### üß™ Test via AWS CLI

Run the following command **without MFA**:

```bash
aws s3 ls
```
‚û°Ô∏è Expected output:
An error occurred (AccessDenied) when calling the ListBuckets operation

After enabling MFA and re-authenticating, run the same command:
```bash
aws s3 ls
```

‚úÖ Expected output:
Lists available S3 buckets, confirming MFA enforcement works properly.

---
### ‚úÖ **Verification Checklist**

- ‚úÖ MFA successfully enabled for IAM user.  
- ‚úÖ Conditional policy created and attached.  
- ‚úÖ Verified that access is blocked without MFA.  
- ‚úÖ Confirmed successful access after MFA login.

